# Домашнее задание к занятию "Разбор скриптов и и их написание"

### Цель задания
В результате выполнения этого задания вы научитесь:
1. Контролировать передачу пользователем параметров скрипту;
2. Проверять входные данные;
3. Проверять, что скрипт запущен с повышенными привилегиями.
------

### Чеклист готовности к домашнему заданию

1. Установлена операционная система Ubuntu на виртуальную машину или локально и имеется доступ к терминалу (удаленный или из графической оболочки)
2. Установлена утилита arping (sudo apt install -y arping)
3. Просмотрены коды скриптов, расположенные по [ссылке](5-05/)
------

### Инструкция к заданию

1. Домашнее задание выполните в [Google Docs](https://docs.google.com/) и отправьте на проверку ссылку на ваш документ в личном кабинете.
2. В названии файла введите корректное название лекции и вашу фамилию и имя.
3. Зайдите в “Настройки доступа” и выберите доступ “Просматривать могут все в Интернете, у кого есть ссылка”. Ссылка на инструкцию [Как предоставить доступ к файлам и папкам на Google Диске](https://support.google.com/docs/answer/2494822?hl=ru&co=GENIE.Platform%3DDesktop)
4. Скопируйте текст задания в свой  Google Документ.
5. Исправьте приведенный bash-скрипт.
6. Для проверки необходимо прикрепить ссылку на ваш Google документ, в котором прописан код скрипта и скриншоты, демонстрирующие различные сценарии работы данного скрипта.
7. Для проверки домашнего задания преподавателем отправьте  в личном кабинете.
8. Любые вопросы по решению задач задавайте в чате учебной группы

------

### Задание 1.


Дан скрипт:

```bash
#!/bin/bash
PREFIX="${1:-NOT_SET}"
INTERFACE="$2"

[[ "$PREFIX" = "NOT_SET" ]] && { echo "\$PREFIX must be passed as first positional argument"; exit 1; }
if [[ -z "$INTERFACE" ]]; then
    echo "\$INTERFACE must be passed as second positional argument"
    exit 1
fi

for SUBNET in {1..255}
do
	for HOST in {1..255}
	do
		echo "[*] IP : ${PREFIX}.${SUBNET}.${HOST}"
		arping -c 3 -i "$INTERFACE" "${PREFIX}.${SUBNET}.${HOST}" 2> /dev/null
	done
done
```


Измените скрипт так, чтобы:

- для ввода пользователем были доступны все параметры. Помимо существующих PREFIX и INTERFACE, сделайте возможность задавать пользователю SUBNET и HOST;
- скрипт должен работать корректно в случае передачи туда только PREFIX и INTERFACE
- скрипт должен сканировать только одну подсеть, если переданы параметры PREFIX, INTERFACE и SUBNET
- скрипт должен сканировать только один IP-адрес, если переданы PREFIX, INTERFACE, SUBNET и HOST
- не забывайте проверять вводимые пользователем параметры с помощью регулярных выражений и знака `=~` в условных операторах 
- проверьте, что скрипт запускается с повышенными привилегиями и сообщите пользователю, если скрипт запускается без них

------
***Ответ:***  
```bash
#!/bin/bash

# Проверка прав root
if [[ $EUID -ne 0 ]]; then
    echo "Этот скрипт должен запускаться с повышенными привилегиями (root)." >&2
    exit 1
fi

# Параметры по умолчанию
PREFIX="${1:-NOT_SET}"
INTERFACE="$2"
SUBNET="$3"
HOST="$4"

# Проверка PREFIX
if [[ "$PREFIX" == "NOT_SET" ]]; then
    echo "\$PREFIX должен быть передан в качестве первого позиционного аргумента" >&2
    exit 1
elif ! [[ "$PREFIX" =~ ^[0-9]{1,3}$ && "$PREFIX" -le 255 ]]; then
    echo "\$PREFIX должен быть числом от 0 до 255" >&2
    exit 1
fi

# Проверка INTERFACE
if [[ -z "$INTERFACE" ]]; then
    echo "\$INTERFACE должен быть передан в качестве второго позиционного аргумента" >&2
    exit 1
elif ! [[ -d "/sys/class/net/$INTERFACE" ]]; then
    echo "Интерфейс $INTERFACE не существует" >&2
    exit 1
fi

# Проверка SUBNET
if [[ -n "$SUBNET" ]]; then
    if ! [[ "$SUBNET" =~ ^[0-9]{1,3}$ && "$SUBNET" -le 255 ]]; then
        echo "\$SUBNET должен быть числом от 0 до 255" >&2
        exit 1
    fi
fi

# Проверка HOST
if [[ -n "$HOST" ]]; then
    if ! [[ "$HOST" =~ ^[0-9]{1,3}$ && "$HOST" -le 255 ]]; then
        echo "\$HOST должен быть числом от 0 до 255" >&2
        exit 1
    fi
    if [[ -z "$SUBNET" ]]; then
        echo "Для сканирования конкретного хоста нужно указать и подсеть (\$SUBNET)" >&2
        exit 1
    fi
fi

# Определение диапазонов сканирования
if [[ -n "$SUBNET" && -n "$HOST" ]]; then
    SUBNET_RANGE=("$SUBNET")
    HOST_RANGE=("$HOST")
elif [[ -n "$SUBNET" ]]; then
    SUBNET_RANGE=("$SUBNET")
    HOST_RANGE=({1..255})
else
    SUBNET_RANGE=({1..255})
    HOST_RANGE=({1..255})
fi

# Сканирование
for SN in "${SUBNET_RANGE[@]}"; do
    for HST in "${HOST_RANGE[@]}"; do
        IP="${PREFIX}.${SN}.${HST}"
        echo "[*] IP: $IP"
        arping -c 3 -i "$INTERFACE" "$IP" 2>/dev/null
    done
done
```

